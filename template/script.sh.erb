#!/usr/bin/env bash

# Copy resource files to correct locations in users home directory
mkdir "${HOME}/.local/share"
cp -r "/shared/ondemand/novaDesktop/desktop-directories" "${HOME}/.local/share/"
cp -r "/shared/ondemand/novaDesktop/applications" "${HOME}/.local/share/"
mkdir "${HOME}/.config/menus"
cp "/shared/ondemand/novaDesktop/xfce-applications.menu" "${HOME}/.config/menus/"

# Change working directory to user's home directory
cd "${HOME}"

# Reset module environment (may require login shell for some HPC clusters)
module purge && module restore

# Ensure that the user's configured login shell is used
export SHELL="$(getent passwd $USER | cut -d: -f7)"

# Start up desktop
echo "Launching desktop '<%= context.desktop %>'..."
source "<%= session.staged_root.join("desktops", "#{context.desktop}.sh") %>"
echo "Desktop '<%= context.desktop %>' ended..."
